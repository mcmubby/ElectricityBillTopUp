name: Build and Publish Agent Portal

on:
  push:
    branches: [ main ]
    paths:
    - 'AgentPortal/**'

jobs:
  build-and-publish:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
      
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 5.0.202

    - name: 'Project Dependencies'
      shell: pwsh
      run: |
        dotnet restore ./AgentPortal/AgentPortal.csproj

    # - name: Build
    #   run: |
    #     cd ./AgentPortal
    #     dotnet build --configuration Release --no-restore

    - name: Publish
      shell: bash
      run: |
        release_name="Agent-Portal-beta"

        dotnet publish ./AgentPortal/AgentPortal.csproj -c Release -o "$release_name"

        7z a -tzip "${release_name}.zip" "./${release_name}/*"

        rm -r "$release_name"

    - name: Release
      uses: softprops/action-gh-release@v1
      with:
        files: "AgentPortal*"
      env:
        GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}